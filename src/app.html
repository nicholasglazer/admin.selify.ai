<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%sveltekit.assets%/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0a0f19" />
    <title>Selify Admin</title>
    <!-- Inline theme script - prevents flash of wrong theme -->
    <script>
      (function () {
        try {
          // Storage key: miozu-theme (shared across Miozu apps)
          // Migration: also check old admin-theme key for backwards compatibility
          let pref = localStorage.getItem('miozu-theme') || localStorage.getItem('admin-theme');

          // Fallback to cookie (check both keys)
          if (!pref || !['light', 'dark', 'system'].includes(pref)) {
            const match = document.cookie.match(/miozu-theme=([^;]+)/) ||
                          document.cookie.match(/admin-theme=([^;]+)/);
            pref = match?.[1];
          }

          // Resolve preference to actual theme
          let theme;
          if (pref === 'light') {
            theme = 'miozu-light';
          } else if (pref === 'dark') {
            theme = 'miozu-dark';
          } else if (pref === 'system') {
            theme = window.matchMedia?.('(prefers-color-scheme: dark)').matches ? 'miozu-dark' : 'miozu-light';
          } else if (pref === 'miozu-light') {
            theme = 'miozu-light';
            pref = 'light'; // Normalize
          } else if (pref === 'miozu-dark') {
            theme = 'miozu-dark';
            pref = 'dark'; // Normalize
          } else {
            // Default to system preference, fallback to dark
            theme = window.matchMedia?.('(prefers-color-scheme: dark)').matches ? 'miozu-dark' : 'miozu-light';
            pref = 'system';
          }

          // Apply immediately
          document.documentElement.setAttribute('data-theme', theme);
          document.documentElement.style.colorScheme = theme === 'miozu-dark' ? 'dark' : 'light';

          // Persist to new key (miozu-theme), remove old key
          localStorage.setItem('miozu-theme', pref);
          localStorage.removeItem('admin-theme');
          document.cookie = `miozu-theme=${pref}; path=/; max-age=31536000; SameSite=Lax`;
          document.cookie = 'admin-theme=; path=/; max-age=0'; // Clear old cookie

          // Enable transitions after initial paint (prevents FOUC)
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              document.documentElement.classList.add('transitions-enabled');
            });
          });
        } catch (e) {
          // Fallback to dark on error
          document.documentElement.setAttribute('data-theme', 'miozu-dark');
          document.documentElement.style.colorScheme = 'dark';
        }
      })();
    </script>
    %sveltekit.head%
  </head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
